<!DOCTYPE html>
<html>
    <head>
        <title>Gameclient - 80 x 24</title>
        <style>
        input {
            font-family:'Monaco','Consolas',monospace;
            font-size:15px;
            margin:0px;
            padding:0px;
            border-top:1px solid black;
            border-bottom:1px solid black;
            border-left:0px;
            border-right:0px 
        }
        input:focus {
            outline-width: 0;
        }
        div {
            font-family:'Monaco','Consolas',monospace;
            font-size:15px;
        }
        b {
            color: #000066
        }
        </style>
    </head>
    <body style="margin:0px">
        <!--
        <iframe id="messageFrame" width="100%" height="70%"></iframe>
        !-->
        <div class="messageOutput"><div>Your incoming data will appear here.</div></div>
        <form id="messageInput" width=100%>
            <input size="80" width="100%" type="text" id="inputLine">
            <input type="hidden" id="resizeValidate">
            <input type="hidden" id="width" value="720">
        </form>
        <script>
            document.getElementById("messageInput").onkeypress = function(e) {
                var key = e.charCode || e.keyCode || 0;     
                if (key == 13) {
                    sendLine()
                    document.getElementById("inputLine").value = ''
                    e.preventDefault();
                }
            }
            var ws = new WebSocket("ws://192.168.1.16:9124/"),
            messages = document.getElementsByTagName('div')[0];
            ws.onopen = function (event) {
                ws.send('PING!');
            };
            ws.onmessage = function (event) {
                console.log('Recived some message text!');
                var data = '';
                var num = 0;
                var numlines = event.data.split("<br>").length;
                while (num < numlines) {
                    data = event.data.split("<br>")[num];
                    var messages = document.getElementsByTagName('div')[0],
                        message = document.createElement('div'),
                        content = document.createTextNode(data);
                    console.log('Received message from server:' + content)
                    if (data === '#quit') {
                        window.parent.getElementById('gameOpen').title="Begin Playing Firefile Scorcery School";
                        window.parent.getElementById('gameOpen').disabled = "";
                        window.close();
                    }
                    message.appendChild(content);
                    messages.appendChild(message);
                    window.scrollTo(0,document.body.scrollHeight);
                    num += 1;
                }
            };
            function sendLine () {
                console.log(document.getElementById("inputLine").value);
                var messages = document.getElementsByTagName('div')[0],
                    message = document.createElement('div'),
                    contentBlock = document.createElement('b'),
                    content = document.createTextNode(document.getElementById('inputLine').value);
                ws.send(document.getElementById("inputLine").value);
                contentBlock.appendChild(content);
                message.appendChild(contentBlock);
                messages.appendChild(message);
                if (document.getElementById('inputLine').value.split(" ")[0] == 'width') {
                    document.getElementById('resizeValidate').value = 'true';
                    window.resizeTo(Math.round(document.getElementById('inputLine').value.split(" ")[1]*9+30), 438);
                    document.getElementById('width').value = Math.round(document.getElementById('inputLine').value.split(" ")[1]+30);
                    document.getElementById('inputLine').size = document.getElementById('inputLine').value.split(" ")[1];
                    document.title = 'Gameclient - ' + document.getElementById('inputLine').value.split(" ")[1] + ' x 24'
                }
            }
            window.onresize = function(e) {
                if (document.getElementById('resizeValidate').value != 'true') {
                    console.log('Fixing!')
                    window.resizeTo(document.getElementById('width').value, 438);
                }
                document.getElementById('resizeValidate').value = '';
            }
        </script>
    </body>
</html>
